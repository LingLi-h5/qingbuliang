<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”˜è®°ç³–æ°´é“º - åˆ¶ä½œä½ çš„ç¬¬ä¸€ç¢—æ¸…è¡¥å‡‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        body {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .scene {
            display: none;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.8s ease;
        }

        .scene.active {
            display: flex;
        }

        h1 {
            color: #e67e22;
            font-size: 2.2rem;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #d35400;
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-align: center;
        }

        p {
            color: #555;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }

        .character {
            width: 120px;
            height: 120px;
            background-color: #f39c12;
            border-radius: 50%;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .character img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .dialogue-box {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            max-width: 90%;
        }

        .dialogue-box:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .option {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            border: none;
            border-radius: 50px;
            padding: 12px 25px;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .option:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .ingredients {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .ingredient {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .ingredient img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ingredient.dragging {
            opacity: 0.7;
            transform: scale(1.1);
        }

        .bowl {
            width: 250px;
            height: 250px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 50%;
            margin: 30px auto;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: center;
            padding: 20px;
        }

        .bowl-item {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .bowl-base {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40%;
            border-radius: 50%;
        }

        .coconut-milk {
            background: linear-gradient(135deg, #fef9d7 0%, #d4d3a3 100%);
        }

        .rock-sugar {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .result-bowl {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 50%;
            margin: 30px auto;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: center;
            padding: 25px;
        }

        .award {
            font-size: 1.5rem;
            color: #e67e22;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
        }

        .btn-next {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .poster {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            text-align: center;
        }

        .poster-title {
            font-size: 1.8rem;
            color: #e67e22;
            margin-bottom: 15px;
        }

        .ingredient-analysis {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .ingredient-tag {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .bowl, .result-bowl {
                width: 200px;
                height: 200px;
            }
            
            .ingredient {
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¼€åœºåŠ¨ç”» -->
        <div class="scene active" id="scene-intro">
            <h1>ç”˜è®°ç³–æ°´é“º</h1>
            <div class="character floating">
                <div style="width:100%;height:100%;background:#f39c12;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:3rem;">ğŸ‘¨â€ğŸ³</div>
            </div>
            <div class="dialogue-box">
                <p>ä»Šå¤©æ˜¯ä½ åœ¨"ç”˜è®°ç³–æ°´é“º"å½“å­¦å¾’çš„ç¬¬ä¸€å¤©ï¼Œæ—å¸ˆå‚…è¦æ•™ä½ åˆ¶ä½œé•‡åº—ä¹‹å®â€”â€”æ¸…è¡¥å‡‰ã€‚ç”¨å¿ƒå­¦ï¼Œèƒ½ä¸èƒ½å‡ºå¸ˆï¼Œå°±çœ‹ä½ çš„æ‚Ÿæ€§äº†ã€‚</p>
            </div>
            <button class="btn-next" onclick="showScene('scene-1')">å¼€å§‹å­¦ä¹ </button>
        </div>

        <!-- ç¬¬ä¸€å¹•ï¼šé€‰æ‹©æ±¤åº• -->
        <div class="scene" id="scene-1">
            <h2>ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©æ±¤åº•</h2>
            <div class="character">
                <div style="width:100%;height:100%;background:#f39c12;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:3rem;">ğŸ‘¨â€ğŸ³</div>
            </div>
            <div class="dialogue-box">
                <p>æ¥äº†ï¼Ÿæ­£å¥½ï¼Œç¶ç«åˆšæ—ºã€‚æ¥åšç¬¬ä¸€ç¢—æ¸…è¡¥å‡‰ã€‚ä¸‡äº‹å¼€å¤´éš¾ï¼Œè¿™ç¬¬ä¸€æ­¥ï¼Œä½ å…ˆé€‰ä¸ªæ±¤åº•ã€‚æ˜¯ç”¨æ¤°å¥¶ï¼Œè¿˜æ˜¯ç”¨å†°ç³–æ°´ï¼Ÿ</p>
            </div>
            <div class="options">
                <button class="option" onclick="selectBase('coconut')">æ¤°å¥¶</button>
                <button class="option" onclick="selectBase('sugar')">å†°ç³–æ°´</button>
            </div>
            <div class="bowl">
                <div class="bowl-base" id="base-liquid"></div>
            </div>
        </div>

        <!-- ç¬¬äºŒå¹•ï¼šæ­é…åŸºç¡€é£Ÿæ -->
        <div class="scene" id="scene-2">
            <h2>ç¬¬äºŒæ­¥ï¼šæ­é…åŸºç¡€é£Ÿæ</h2>
            <div class="character">
                <div style="width:100%;height:100%;background:#f39c12;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:3rem;">ğŸ‘¨â€ğŸ³</div>
            </div>
            <div class="dialogue-box">
                <p>æ±¤åº•æœ‰äº†ï¼Œç°åœ¨è¦æ­ä¸ª"éª¨æ¶"ã€‚çº¢è±†ã€ç»¿è±†ã€è–ç±³ã€ç™¾åˆã€è²å­ï¼Œè¿™å‡ æ ·æ˜¯åŸºç¡€ã€‚ä½ æŠŠå®ƒä»¬éƒ½æ‹–åˆ°ç¢—é‡Œæ¥ã€‚</p>
            </div>
            <div class="ingredients">
                <div class="ingredient" draggable="true" data-ingredient="red-bean" style="background:#e74c3c;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">çº¢è±†</div>
                <div class="ingredient" draggable="true" data-ingredient="green-bean" style="background:#2ecc71;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">ç»¿è±†</div>
                <div class="ingredient" draggable="true" data-ingredient="barley" style="background:#f1c40f;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">è–ç±³</div>
                <div class="ingredient" draggable="true" data-ingredient="lily" style="background:#ecf0f1;color:#333;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">ç™¾åˆ</div>
                <div class="ingredient" draggable="true" data-ingredient="lotus" style="background:#9b59b6;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">è²å­</div>
            </div>
            <div class="bowl" id="base-bowl" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="bowl-base" id="base-liquid-2"></div>
            </div>
            <button class="btn-next" id="btn-base-done" disabled onclick="showScene('scene-3')">ç»§ç»­</button>
        </div>

        <!-- ç¬¬ä¸‰å¹•ï¼šä¸ªæ€§åŒ–å¢å‘³ -->
        <div class="scene" id="scene-3">
            <h2>ç¬¬ä¸‰æ­¥ï¼šä¸ªæ€§åŒ–å¢å‘³</h2>
            <div class="character">
                <div style="width:100%;height:100%;background:#f39c12;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:3rem;">ğŸ‘¨â€ğŸ³</div>
            </div>
            <div class="dialogue-box">
                <p>åŸºç¡€çš„é½äº†ï¼Œç°åœ¨è®²"çµæ€§"ã€‚é£Ÿå®¢çš„å£å‘³å„ä¸ç›¸åŒï¼Œè¿™æ—¶å€™å°±è¦é è¿™äº›æ¥å¢å‘³ã€‚è¥¿ç“œæ¸…ç”œï¼Œé¾Ÿè‹“è†å›ç”˜ï¼ŒèŠ‹åœ†æœ‰åš¼å¤´â€¦ ä½ æ ¹æ®è‡ªå·±çš„æƒ³æ³•ï¼Œéšæ„åŠ ä¸€ä¸¤æ ·è¿›å»ã€‚</p>
            </div>
            <div class="ingredients">
                <div class="ingredient" draggable="true" data-ingredient="watermelon" style="background:#e74c3c;" ondrop="drop2(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">è¥¿ç“œ</div>
                <div class="ingredient" draggable="true" data-ingredient="mango" style="background:#f39c12;" ondrop="drop2(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">èŠ’æœ</div>
                <div class="ingredient" draggable="true" data-ingredient="turtle-jelly" style="background:#34495e;" ondrop="drop2(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">é¾Ÿè‹“è†</div>
                <div class="ingredient" draggable="true" data-ingredient="grass-jelly" style="background:#2c3e50;" ondrop="drop2(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">ä»™è‰</div>
                <div class="ingredient" draggable="true" data-ingredient="taro-ball" style="background:#8e44ad;" ondrop="drop2(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">èŠ‹åœ†</div>
                <div class="ingredient" draggable="true" data-ingredient="sago" style="background:#ecf0f1;color:#333;" ondrop="drop2(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">è¥¿ç±³</div>
            </div>
            <div class="bowl" id="flavor-bowl" ondrop="drop2(event)" ondragover="allowDrop(event)">
                <div class="bowl-base" id="base-liquid-3"></div>
            </div>
            <button class="btn-next" onclick="showScene('scene-4')">ç»§ç»­</button>
        </div>

        <!-- ç¬¬å››å¹•ï¼šç”»é¾™ç‚¹ç› -->
        <div class="scene" id="scene-4">
            <h2>ç¬¬å››æ­¥ï¼šç”»é¾™ç‚¹ç›</h2>
            <div class="character">
                <div style="width:100%;height:100%;background:#f39c12;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:3rem;">ğŸ‘¨â€ğŸ³</div>
            </div>
            <div class="dialogue-box">
                <p>æœ€åä¸€æ­¥ï¼Œç”»é¾™ç‚¹ç›ã€‚æ’’ä¸Šå‡ ç²’èŠ±ç”Ÿç¢å¢é¦™ï¼Œæˆ–æ˜¯æ·‹ä¸€å‹ºç‚¼å¥¶æé†‡ã€‚è¿™ä¸€æ­¥ï¼Œäº¤ç»™ä½ äº†ã€‚</p>
            </div>
            <div class="ingredients">
                <div class="ingredient" draggable="true" data-ingredient="peanut" style="background:#d35400;" ondrop="drop3(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">èŠ±ç”Ÿç¢</div>
                <div class="ingredient" draggable="true" data-ingredient="condensed-milk" style="background:#f5f5f5;color:#333;" ondrop="drop3(event)" ondragover="allowDrop(event)" ondragstart="drag(event)">ç‚¼å¥¶</div>
            </div>
            <div class="bowl" id="final-bowl" ondrop="drop3(event)" ondragover="allowDrop(event)">
                <div class="bowl-base" id="base-liquid-4"></div>
            </div>
            <button class="btn-next" onclick="showScene('scene-result')">å®Œæˆåˆ¶ä½œ</button>
        </div>

        <!-- æœ€ç»ˆæˆæœä¸è¯„ä»· -->
        <div class="scene" id="scene-result">
            <h2>æ­å–œä½ å®Œæˆæ¸…è¡¥å‡‰ï¼</h2>
            <div class="character">
                <div style="width:100%;height:100%;background:#f39c12;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:3rem;">ğŸ‘¨â€ğŸ³</div>
            </div>
            <div class="result-bowl" id="result-bowl">
                <div class="bowl-base" id="base-liquid-result"></div>
            </div>
            <div class="dialogue-box">
                <p id="final-comment"></p>
            </div>
            <div class="award" id="award-title"></div>
            <button class="btn-next" onclick="showScene('scene-poster')">æŸ¥çœ‹æˆæœæµ·æŠ¥</button>
        </div>

        <!-- æˆæœæµ·æŠ¥ -->
        <div class="scene" id="scene-poster">
            <h2>ä½ çš„æ¸…è¡¥å‡‰åˆ¶ä½œå®Œæˆï¼</h2>
            <div class="poster">
                <div class="poster-title">ç”˜è®°ç³–æ°´é“º Â· æ¸…è¡¥å‡‰</div>
                <div class="result-bowl" id="poster-bowl">
                    <div class="bowl-base" id="base-liquid-poster"></div>
                </div>
                <div class="award" id="poster-award"></div>
                <p id="poster-comment"></p>
                <div class="ingredient-analysis" id="ingredient-analysis">
                    <!-- åŠ¨æ€ç”Ÿæˆé£Ÿæåˆ†æ -->
                </div>
                <p>è®°ä½å–½ï¼Œç³–æ°´æ— å®šå¼ï¼Œäººå¿ƒæœ‰å†·æš–ã€‚ä¸€ç¢—å¥½çš„æ¸…è¡¥å‡‰ï¼Œé£Ÿææ˜¯è¡¨ï¼Œç”¨å¿ƒæ‰æ˜¯é‡Œã€‚æ­å–œä½ ï¼Œä»Šå¤©æ­£å¼å‡ºå¸ˆäº†ï¼</p>
            </div>
            <button class="btn-next" onclick="location.reload()">å†åˆ¶ä½œä¸€ç¢—</button>
        </div>
    </div>

    <script>
        // ç”¨æˆ·é€‰æ‹©è®°å½•
        const userChoices = {
            base: '',
            baseIngredients: [],
            flavorIngredients: [],
            topping: ''
        };

        // åœºæ™¯åˆ‡æ¢
        function showScene(sceneId) {
            document.querySelectorAll('.scene').forEach(scene => {
                scene.classList.remove('active');
            });
            document.getElementById(sceneId).classList.add('active');
            
            // åˆå§‹åŒ–æ‹–åŠ¨åŠŸèƒ½
            if (sceneId === 'scene-2' || sceneId === 'scene-3' || sceneId === 'scene-4') {
                initializeDragAndDrop();
            }
            
            // æ›´æ–°ç¢—çš„å†…å®¹
            updateBowlContent();
        }

        // é€‰æ‹©æ±¤åº•
        function selectBase(baseType) {
            userChoices.base = baseType;
            const baseLiquid = document.getElementById('base-liquid');
            
            if (baseType === 'coconut') {
                baseLiquid.className = 'bowl-base coconut-milk';
                document.querySelector('#scene-1 .dialogue-box p').innerHTML = 
                    'æœ‰çœ¼å…‰ï¼æ¤°å¥¶é¦™é†‡æ¸©æ¶¦ï¼Œæ˜¯æµ·å—æ´¾çš„çµé­‚ã€‚ç”¨å®ƒåšåº•ï¼Œé£Ÿæçš„æ»‹å‘³èƒ½èåœ¨ä¸€èµ·ï¼Œå£æ„Ÿæœ€æ˜¯é¡ºæ»‘ã€‚';
            } else {
                baseLiquid.className = 'bowl-base rock-sugar';
                document.querySelector('#scene-1 .dialogue-box p').innerHTML = 
                    'å¥½ï¼å†°ç³–æ°´æ¸…ç”œé€äº®ï¼Œæ˜¯å’±ä»¬å¹¿åºœçš„è€ä¼ ç»Ÿã€‚æœ€èƒ½è¡¬å‡ºé£Ÿææœ¬èº«çš„å‘³é“ï¼Œæ¸…çƒ­è§£æš‘çš„æ•ˆæœä¹Ÿæœ€å¥½ã€‚';
            }
            
            // æ›´æ–°å…¶ä»–åœºæ™¯çš„æ±¤åº•
            document.getElementById('base-liquid-2').className = baseLiquid.className;
            document.getElementById('base-liquid-3').className = baseLiquid.className;
            document.getElementById('base-liquid-4').className = baseLiquid.className;
            document.getElementById('base-liquid-result').className = baseLiquid.className;
            document.getElementById('base-liquid-poster').className = baseLiquid.className;
            
            setTimeout(() => showScene('scene-2'), 1500);
        }

        // æ‹–æ”¾åŠŸèƒ½
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.getAttribute('data-ingredient'));
            ev.target.classList.add('dragging');
        }

        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡è¯¥é£Ÿæ
            if (!userChoices.baseIngredients.includes(data)) {
                userChoices.baseIngredients.push(data);
                
                // æ·»åŠ é£Ÿæåˆ°ç¢—ä¸­
                const bowlItem = document.createElement('div');
                bowlItem.className = 'bowl-item';
                bowlItem.style.backgroundColor = ev.target.style.backgroundColor;
                bowlItem.textContent = ev.target.textContent;
                document.getElementById('base-bowl').appendChild(bowlItem);
                
                // æ›´æ–°å¸ˆå‚…çš„è¯„è®º
                updateBaseComment(data);
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰åŸºç¡€é£Ÿæéƒ½å·²æ·»åŠ 
                if (userChoices.baseIngredients.length === 5) {
                    document.getElementById('btn-base-done').disabled = false;
                    document.querySelector('#scene-2 .dialogue-box p').innerHTML = 
                        'éª¨æ¶è¿™å°±æ­ç¨³äº†ã€‚ä½ çœ‹ï¼Œè¿™ç¢—é‡Œäº”è‰²ä¿±å…¨ï¼Œå·²ç»æœ‰ç‚¹æ ·å­äº†ã€‚';
                }
            }
            
            // ç§»é™¤æ‹–åŠ¨æ ·å¼
            document.querySelectorAll('.ingredient').forEach(item => {
                item.classList.remove('dragging');
            });
        }

        function drop2(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡è¯¥é£Ÿæ
            if (!userChoices.flavorIngredients.includes(data)) {
                userChoices.flavorIngredients.push(data);
                
                // æ·»åŠ é£Ÿæåˆ°ç¢—ä¸­
                const bowlItem = document.createElement('div');
                bowlItem.className = 'bowl-item';
                bowlItem.style.backgroundColor = ev.target.style.backgroundColor;
                bowlItem.textContent = ev.target.textContent;
                document.getElementById('flavor-bowl').appendChild(bowlItem);
                
                // æ›´æ–°å¸ˆå‚…çš„è¯„è®º
                updateFlavorComment(data);
            }
            
            // ç§»é™¤æ‹–åŠ¨æ ·å¼
            document.querySelectorAll('.ingredient').forEach(item => {
                item.classList.remove('dragging');
            });
        }

        function drop3(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            
            // è®¾ç½® topping
            userChoices.topping = data;
            
            // æ·»åŠ é£Ÿæåˆ°ç¢—ä¸­
            const bowlItem = document.createElement('div');
            bowlItem.className = 'bowl-item';
            bowlItem.style.backgroundColor = ev.target.style.backgroundColor;
            bowlItem.textContent = ev.target.textContent;
            document.getElementById('final-bowl').appendChild(bowlItem);
            
            // æ›´æ–°å¸ˆå‚…çš„è¯„è®º
            document.querySelector('#scene-4 .dialogue-box p').innerHTML = 
                'å¥½ï¼ä¸€ç¢—ç‹¬ä¸€æ— äºŒçš„æ¸…è¡¥å‡‰ï¼Œè¿™å°±æˆäº†ï¼';
            
            // ç§»é™¤æ‹–åŠ¨æ ·å¼
            document.querySelectorAll('.ingredient').forEach(item => {
                item.classList.remove('dragging');
            });
        }

        // æ›´æ–°åŸºç¡€é£Ÿæè¯„è®º
        function updateBaseComment(ingredient) {
            const comments = {
                'red-bean': 'å—¯ï¼Œçº¢è±†è¡¥å¿ƒå…»è¡€ï¼Œå¥½ã€‚',
                'green-bean': 'ç»¿è±†æ¸…çƒ­è§£æ¯’ï¼Œå¤å¤©å°‘ä¸äº†å®ƒã€‚',
                'barley': 'è–ç±³å¥½ï¼Œç¥›æ¹¿å¥è„¾ã€‚ç°ä»£äººå¾…åœ¨ç©ºè°ƒæˆ¿é‡Œï¼Œæ¹¿æ°”é‡ï¼Œè¿™ä¸ªè¦å¤šæ”¾äº›ã€‚',
                'lily': 'ç™¾åˆæ¶¦è‚ºæ­¢å’³ï¼Œå®å¿ƒå®‰ç¥ï¼Œæ˜¯å¥½ä¸œè¥¿ã€‚',
                'lotus': 'è²å­å…»å¿ƒå®‰ç¥ï¼Œå¥è„¾è¡¥è‚¾ï¼Œæ­é…å¾—å¥½ã€‚'
            };
            
            document.querySelector('#scene-2 .dialogue-box p').innerHTML = comments[ingredient];
        }

        // æ›´æ–°å¢å‘³é£Ÿæè¯„è®º
        function updateFlavorComment(ingredient) {
            const comments = {
                'watermelon': 'å“ˆå“ˆï¼ŒåŠ äº†æ°´æœï¼Œå¤šäº†ä»½é²œçˆ½ï¼Œå¹´è½»äººæœ€çˆ±è¿™ä¸€å£ã€‚',
                'mango': 'èŠ’æœé¦™ç”œï¼Œç»™ç³–æ°´å¢æ·»äº†çƒ­å¸¦é£å‘³ï¼Œä¸é”™ã€‚',
                'turtle-jelly': 'å“¦ï¼ŸåŠ äº†é¾Ÿè‹“è†ï¼Œæ¸…çƒ­é™ç«çš„åŠŸæ•ˆå°±æ›´ä¸Šä¸€å±‚æ¥¼äº†ï¼Œä¼šåƒè‹¦ï¼Œæ˜¯æ‡‚è¡Œçš„ã€‚',
                'grass-jelly': 'ä»™è‰æ»‘å«©ï¼Œæ¸…çƒ­è§£æš‘ï¼Œæ˜¯å¤æ—¥ä½³å“ã€‚',
                'taro-ball': 'Qå¼¹çˆ½æ»‘ï¼Œè¿™ç¢—ç³–æ°´åƒèµ·æ¥å°±æ›´æœ‰è¶£äº†ã€‚',
                'sago': 'è¥¿ç±³æ™¶è¹å‰”é€ï¼Œå£æ„Ÿç‹¬ç‰¹ï¼ŒåŠ å¾—å¥½ã€‚'
            };
            
            document.querySelector('#scene-3 .dialogue-box p').innerHTML = comments[ingredient];
        }

        // åˆå§‹åŒ–æ‹–æ”¾åŠŸèƒ½
        function initializeDragAndDrop() {
            document.querySelectorAll('.ingredient').forEach(item => {
                item.setAttribute('draggable', 'true');
            });
        }

        // æ›´æ–°ç¢—çš„å†…å®¹
        function updateBowlContent() {
            // æ›´æ–°æœ€ç»ˆç»“æœç¢—
            const resultBowl = document.getElementById('result-bowl');
            resultBowl.innerHTML = '<div class="bowl-base" id="base-liquid-result"></div>';
            
            // æ·»åŠ åŸºç¡€é£Ÿæ
            userChoices.baseIngredients.forEach(ingredient => {
                const bowlItem = document.createElement('div');
                bowlItem.className = 'bowl-item';
                bowlItem.textContent = getIngredientName(ingredient);
                bowlItem.style.backgroundColor = getIngredientColor(ingredient);
                resultBowl.appendChild(bowlItem);
            });
            
            // æ·»åŠ å¢å‘³é£Ÿæ
            userChoices.flavorIngredients.forEach(ingredient => {
                const bowlItem = document.createElement('div');
                bowlItem.className = 'bowl-item';
                bowlItem.textContent = getIngredientName(ingredient);
                bowlItem.style.backgroundColor = getIngredientColor(ingredient);
                resultBowl.appendChild(bowlItem);
            });
            
            // æ·»åŠ ç‚¹ç¼€
            if (userChoices.topping) {
                const bowlItem = document.createElement('div');
                bowlItem.className = 'bowl-item';
                bowlItem.textContent = getIngredientName(userChoices.topping);
                bowlItem.style.backgroundColor = getIngredientColor(userChoices.topping);
                resultBowl.appendChild(bowlItem);
            }
            
            // æ›´æ–°æµ·æŠ¥ç¢—
            const posterBowl = document.getElementById('poster-bowl');
            posterBowl.innerHTML = '<div class="bowl-base" id="base-liquid-poster"></div>';
            resultBowl.querySelectorAll('.bowl-item').forEach(item => {
                posterBowl.appendChild(item.cloneNode(true));
            });
            
            // è®¾ç½®æœ€ç»ˆè¯„ä»·
            setFinalEvaluation();
        }

        // è·å–é£Ÿæåç§°
        function getIngredientName(key) {
            const names = {
                'red-bean': 'çº¢è±†',
                'green-bean': 'ç»¿è±†',
                'barley': 'è–ç±³',
                'lily': 'ç™¾åˆ',
                'lotus': 'è²å­',
                'watermelon': 'è¥¿ç“œ',
                'mango': 'èŠ’æœ',
                'turtle-jelly': 'é¾Ÿè‹“è†',
                'grass-jelly': 'ä»™è‰',
                'taro-ball': 'èŠ‹åœ†',
                'sago': 'è¥¿ç±³',
                'peanut': 'èŠ±ç”Ÿ',
                'condensed-milk': 'ç‚¼å¥¶'
            };
            return names[key] || key;
        }

        // è·å–é£Ÿæé¢œè‰²
        function getIngredientColor(key) {
            const colors = {
                'red-bean': '#e74c3c',
                'green-bean': '#2ecc71',
                'barley': '#f1c40f',
                'lily': '#ecf0f1',
                'lotus': '#9b59b6',
                'watermelon': '#e74c3c',
                'mango': '#f39c12',
                'turtle-jelly': '#34495e',
                'grass-jelly': '#2c3e50',
                'taro-ball': '#8e44ad',
                'sago': '#ecf0f1',
                'peanut': '#d35400',
                'condensed-milk': '#f5f5f5'
            };
            return colors[key] || '#95a5a6';
        }

        // è®¾ç½®æœ€ç»ˆè¯„ä»·
        function setFinalEvaluation() {
            let award = '';
            let comment = '';
            
            // åˆ¤æ–­å¥–é¡¹ç±»å‹
            if (userChoices.flavorIngredients.length === 0 && userChoices.topping === '') {
                // ä¼ ç»Ÿå®—å¸ˆå¥–
                award = 'ä¼ ç»Ÿå®—å¸ˆå¥–';
                comment = 'åŠŸåº•æ‰å®ï¼Œæ·±å¾—ä¼ ç»Ÿç²¾é«“ï¼ä½ è¿™ç¢—ï¼Œæœ‰æˆ‘ä»¬"ç”˜è®°"ä¸‰åå¹´å‰çš„è€å‘³é“äº†ï¼';
            } else if (userChoices.flavorIngredients.includes('watermelon') || 
                      userChoices.flavorIngredients.includes('mango') || 
                      userChoices.flavorIngredients.includes('taro-ball')) {
                // åˆ›æ–°æ´»åŠ›å¥–
                award = 'åˆ›æ–°æ´»åŠ›å¥–';
                comment = 'å¤´è„‘çµæ´»ï¼Œæ•¢äºåˆ›æ–°ï¼ç³–æ°´æ–‡åŒ–å°±æ˜¯è¦é ä½ ä»¬è¿™æ ·çš„å¹´è½»äººå‘æ‰¬å…‰å¤§ï¼';
            } else if (userChoices.baseIngredients.includes('barley') || 
                      userChoices.flavorIngredients.includes('turtle-jelly')) {
                // å…»ç”Ÿä¸“å®¶å¥–
                award = 'å…»ç”Ÿä¸“å®¶å¥–';
                comment = 'æ­é…å¾—å½“ï¼Œè¯é£ŸåŒæºä¹‹ç†ä½ å·²åˆçª¥é—¨å¾„ï¼è¿™ç¢—ç³–æ°´ï¼Œå¯æŠµåŠå‰¯æ–¹å‰‚å•Šï¼';
            } else {
                // éšå¿ƒæ‰€æ¬²å¥–
                award = 'éšå¿ƒæ‰€æ¬²å¥–';
                comment = 'ä¸æ‹˜ä¸€æ ¼ï¼Œè‡ªæˆä¸€æ´¾ï¼ç³–æ°´å˜›ï¼Œè‡ªå·±åƒå¾—å¼€å¿ƒï¼Œå°±æ˜¯æœ€å¥½çš„é…æ–¹ã€‚';
            }
            
            document.getElementById('final-comment').textContent = comment;
            document.getElementById('award-title').textContent = award;
            document.getElementById('poster-comment').textContent = comment;
            document.getElementById('poster-award').textContent = award;
            
            // æ›´æ–°é£Ÿæåˆ†æ
            const analysisContainer = document.getElementById('ingredient-analysis');
            analysisContainer.innerHTML = '';
            
            // æ·»åŠ æ±¤åº•
            const baseTag = document.createElement('div');
            baseTag.className = 'ingredient-tag';
            baseTag.textContent = userChoices.base === 'coconut' ? 'æ¤°å¥¶æ±¤åº•' : 'å†°ç³–æ°´æ±¤åº•';
            analysisContainer.appendChild(baseTag);
            
            // æ·»åŠ åŸºç¡€é£Ÿæ
            userChoices.baseIngredients.forEach(ingredient => {
                const tag = document.createElement('div');
                tag.className = 'ingredient-tag';
                tag.textContent = getIngredientName(ingredient);
                analysisContainer.appendChild(tag);
            });
            
            // æ·»åŠ å¢å‘³é£Ÿæ
            userChoices.flavorIngredients.forEach(ingredient => {
                const tag = document.createElement('div');
                tag.className = 'ingredient-tag';
                tag.textContent = getIngredientName(ingredient);
                analysisContainer.appendChild(tag);
            });
            
            // æ·»åŠ ç‚¹ç¼€
            if (userChoices.topping) {
                const tag = document.createElement('div');
                tag.className = 'ingredient-tag';
                tag.textContent = getIngredientName(userChoices.topping);
                analysisContainer.appendChild(tag);
            }
        }
    </script>
</body>
</html>